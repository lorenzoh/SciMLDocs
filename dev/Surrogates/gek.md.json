{"attributes":{"backlinks":[],"path":"/Users/lorenz/.julia/packages/Surrogates/zwNvG/docs/src/gek.md","title":"gek"},"tag":"document","children":[{"attributes":{},"tag":"md","children":[{"attributes":{},"tag":"h2","children":["Gradient Enhanced Kriging"],"type":"node"},{"attributes":{},"tag":"p","children":["Gradient-enhanced Kriging is an extension of kriging which supports gradient information. GEK is usually more accurate than kriging, however, it is not computationally efficient when the number of inputs, the number of sampling points, or both, are high. This is mainly due to the size of the corresponding correlation matrix that increases proportionally with both the number of inputs and the number of sampling points."],"type":"node"},{"attributes":{},"tag":"p","children":["Let's have a look to the following function to use Gradient Enhanced Surrogate: ",{"attributes":{},"tag":"math","children":["f(x) = sin(x) + 2*x^2"],"type":"node"}],"type":"node"},{"attributes":{},"tag":"p","children":["First of all, we will import ",{"attributes":{},"tag":"code","children":["Surrogates"],"type":"node"}," and ",{"attributes":{},"tag":"code","children":["Plots"],"type":"node"}," packages:"],"type":"node"},{"attributes":{"lang":"@example GEK1D"},"tag":"codeblock","children":["using Surrogates\nusing Plots\ndefault()\n"],"type":"node"},{"attributes":{},"tag":"h3","children":["Sampling"],"type":"node"},{"attributes":{},"tag":"p","children":["We choose to sample f in 8 points between 0 to 1 using the ",{"attributes":{},"tag":"code","children":["sample"],"type":"node"}," function. The sampling points are chosen using a Sobol sequence, this can be done by passing ",{"attributes":{},"tag":"code","children":["SobolSample()"],"type":"node"}," to the ",{"attributes":{},"tag":"code","children":["sample"],"type":"node"}," function."],"type":"node"},{"attributes":{"lang":"@example GEK1D"},"tag":"codeblock","children":["n_samples = 10\nlower_bound = 2\nupper_bound = 10\nxs = lower_bound:0.001:upper_bound\nx = sample(n_samples, lower_bound, upper_bound, SobolSample())\nf(x) = x^3 - 6x^2 + 4x + 12\ny1 = f.(x)\nder = x -> 3*x^2 - 12*x + 4\ny2 = der.(x)\ny = vcat(y1,y2)\nscatter(x, y1, label=\"Sampled points\", xlims=(lower_bound, upper_bound), legend=:top)\nplot!(f, label=\"True function\", xlims=(lower_bound, upper_bound), legend=:top)\n"],"type":"node"},{"attributes":{},"tag":"h3","children":["Building a surrogate"],"type":"node"},{"attributes":{},"tag":"p","children":["With our sampled points we can build the Gradient Enhanced Kriging surrogate using the ",{"attributes":{},"tag":"code","children":["GEK"],"type":"node"}," function."],"type":"node"},{"attributes":{"lang":"@example GEK1D"},"tag":"codeblock","children":["my_gek = GEK(x, y, lower_bound, upper_bound, p = 1.4);\n"],"type":"node"},{"attributes":{"lang":"@example @GEK1D"},"tag":"codeblock","children":["scatter(x, y1, label=\"Sampled points\", xlims=(lower_bound, upper_bound), legend=:top)\nplot!(f, label=\"True function\",  xlims=(lower_bound, upper_bound), legend=:top)\nplot!(my_gek, label=\"Surrogate function\", ribbon=p->std_error_at_point(my_gek, p), xlims=(lower_bound, upper_bound), legend=:top)\n"],"type":"node"},{"attributes":{},"tag":"h2","children":["Gradient Enhanced Kriging Surrogate Tutorial (ND)"],"type":"node"},{"attributes":{},"tag":"p","children":["First of all let's define the function we are going to build a surrogate for."],"type":"node"},{"attributes":{"lang":"@example GEK_ND"},"tag":"codeblock","children":["using Plots # hide\ndefault(c=:matter, legend=false, xlabel=\"x\", ylabel=\"y\") # hide\nusing Surrogates # hide\n"],"type":"node"},{"attributes":{},"tag":"p","children":["Now, let's define the function:"],"type":"node"},{"attributes":{"lang":"@example GEK_ND"},"tag":"codeblock","children":["function leon(x)\n      x1 = x[1]\n      x2 = x[2]\n      term1 = 100*(x2 - x1^3)^2\n      term2 = (1 - x1)^2\n      y = term1 + term2\nend\n"],"type":"node"},{"attributes":{},"tag":"h3","children":["Sampling"],"type":"node"},{"attributes":{},"tag":"p","children":["Let's define our bounds, this time we are working in two dimensions. In particular we want our first dimension ",{"attributes":{},"tag":"code","children":["x"],"type":"node"}," to have bounds ",{"attributes":{},"tag":"code","children":["0, 10"],"type":"node"},", and ",{"attributes":{},"tag":"code","children":["0, 10"],"type":"node"}," for the second dimension. We are taking 80 samples of the space using Sobol Sequences. We then evaluate our function on all of the sampling points."],"type":"node"},{"attributes":{"lang":"@example GEK_ND"},"tag":"codeblock","children":["n_samples = 80\nlower_bound = [0, 0]\nupper_bound = [10, 10]\nxys = sample(n_samples, lower_bound, upper_bound, SobolSample())\ny1 = leon.(xys);\n"],"type":"node"},{"attributes":{"lang":"@example GEK_ND"},"tag":"codeblock","children":["x, y = 0:10, 0:10 # hide\np1 = surface(x, y, (x1,x2) -> leon((x1,x2))) # hide\nxs = [xy[1] for xy in xys] # hide\nys = [xy[2] for xy in xys] # hide\nscatter!(xs, ys, y1) # hide\np2 = contour(x, y, (x1,x2) -> leon((x1,x2))) # hide\nscatter!(xs, ys) # hide\nplot(p1, p2, title=\"True function\") # hide\n"],"type":"node"},{"attributes":{},"tag":"h3","children":["Building a surrogate"],"type":"node"},{"attributes":{},"tag":"p","children":["Using the sampled points we build the surrogate, the steps are analogous to the 1-dimensional case."],"type":"node"},{"attributes":{"lang":"@example GEK_ND"},"tag":"codeblock","children":["grad1 = x1 -> 2*(300*(x[1])^5 - 300*(x[1])^2*x[2] + x[1] -1)\ngrad2 = x2 -> 200*(x[2] - (x[1])^3)\nd = 2\nn = 10\nfunction create_grads(n, d, grad1, grad2, y)\n      c = 0\n      y2 = zeros(eltype(y[1]),n*d)\n      for i in 1:n\n            y2[i + c] = grad1(x[i])\n            y2[i + c + 1] = grad2(x[i])\n            c = c + 1\n      end\n      return y2\nend\ny2 = create_grads(n, d, grad2, grad2, y)\ny = vcat(y1,y2)\n"],"type":"node"},{"attributes":{"lang":"@example GEK_ND"},"tag":"codeblock","children":["my_GEK = GEK(xys, y, lower_bound, upper_bound, p=[1.9, 1.9])\n"],"type":"node"},{"attributes":{"lang":"@example GEK_ND"},"tag":"codeblock","children":["p1 = surface(x, y, (x, y) -> my_GEK([x y])) # hide\nscatter!(xs, ys, y1, marker_z=y1) # hide\np2 = contour(x, y, (x, y) -> my_GEK([x y])) # hide\nscatter!(xs, ys, marker_z=y1) # hide\nplot(p1, p2, title=\"Surrogate\") # hide\n"],"type":"node"}],"type":"node"}],"type":"node"}